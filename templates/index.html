<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ALARM LASER - ULTRA RÁPIDO</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    body { background: #000; color: #0f0; font-family: 'Courier New', monospace; text-align: center; padding: 20px; }
    h1 { font-size: 3em; text-shadow: 0 0 20px #0f0; margin-bottom: 10px; }
    .status {
      font-size: 2.5em; padding: 20px; border-radius: 15px; margin: 20px auto;
      max-width: 900px; transition: all 0.3s; font-weight: bold;
    }
    .status.safe { background: rgba(0,255,0,0.2); border: 4px solid #0f0; }
    .status.alert { 
      background: rgba(255,0,0,0.6); border: 4px solid #f00; color: #fff;
      animation: pulso 0.8s infinite; text-shadow: 0 0 15px #f00;
    }
    @keyframes pulso { 50% { opacity: 0.7; } }
    .log {
      background: #111; padding: 20px; border-radius: 15px; max-width: 900px;
      margin: 20px auto; text-align: left; border: 2px solid #0f0; max-height: 70vh; overflow-y: auto;
    }
    .entry { padding: 10px; border-bottom: 1px dashed #0f0; font-size: 1.1em; }
    .time { color: #0ff; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ALARM LASER SYSTEM</h1>
  <div id="status" class="status safe">Sistema armado - Todo seguro</div>
  
  <h2>Últimas alertas (actualiza cada segundo)</h2>
  <div id="log" class="log"></div>

  <script>
    const status = document.getElementById('status');
    const log = document.getElementById('log');

    async function actualizarTodo() {
      try {
        const res = await fetch('/api/alerta?' + Date.now()); // evita caché
        const data = await res.json();

        log.innerHTML = '';
        let hayIntruso = false;

        data.alertas.forEach(a => {
          const div = document.createElement('div');
          div.className = 'entry';
          div.innerHTML = `<span class="time">[${a.timestamp}]</span> ${a.mensaje}`;
          log.prepend(div); // arriba las nuevas

          if (a.mensaje.toUpperCase().includes("INTRUSO") || 
              a.mensaje.toUpperCase().includes("CORTADO") || 
              a.mensaje.toUpperCase().includes("DETECTADO")) {
            hayIntruso = true;
          }
        });

        // Cambiar estado al instante
        if (hayIntruso) {
          status.textContent = "¡INTRUSO DETECTADO!";
          status.className = "status alert";
        } else {
          status.textContent = "Sistema armado - Todo seguro";
          status.className = "status safe";
        }

      } catch (err) {
        console.log("Error de conexión temporal...");
      }
    }

    // Carga inmediata al abrir
    actualizarTodo();

    // ACTUALIZA CADA 1000ms = 1 segundo (puedes bajar a 500ms si quieres aún más rápido)
    setInterval(actualizarTodo, 1000);

    // Opcional: aún más rápido → cada medio segundo
    // setInterval(actualizarTodo, 500);
  </script>
</body>
</html>